"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[916],{24760:function(t,e,a){var o={};a.r(o),a.d(o,{deleteAutomation:function(){return P},duplicateAutomation:function(){return O},loadAutomations:function(){return C},restoreAutomation:function(){return Z},trashAutomation:function(){return U}});var n={};a.r(n),a.d(n,{getAutomationCount:function(){return L},getAutomations:function(){return D}});var i=a(70079),s=a(99581),l=a(26952),r=a(44520),u=a(93850),m=a(59216),c=a(10159),d=a(75987),p=a(37262);const h="mailpoet/automation-listing";var _=a(64826),g=a(81433),x=a(710);function f(t,e){switch(e.type){case"SET_AUTOMATIONS":return{...t,automations:e.automations};case"ADD_AUTOMATION":return{...t,automations:[e.automation,...t.automations]};case"UPDATE_AUTOMATION":return{...t,automations:t.automations.map((t=>t.id===e.automation.id?e.automation:t))};case"DELETE_AUTOMATION":return{...t,automations:t.automations.filter((t=>t.id!==e.automation.id))};default:return t}}var j=a(7936),b=a(46824),y=a(57834),v=a(3939),A=a(15312),T=a(12025),w=a(35250);function N(t){let{automation:e,label:a}=t;return(0,w.jsx)(v.ZP,{variant:"link",href:(0,A.f)(T.x.urls.automationEditor,{id:e.id}),children:a??(0,j.__)("Edit","mailpoet")})}var k=a(48405);function S(t){let{automation:e,previousStatus:a}=t;const{restoreAutomation:o}=(0,k.Z)(h);return(0,w.jsx)(v.ZP,{variant:"link",onClick:()=>o(e,a),children:(0,j.__)("Undo","mailpoet")})}const E=(t,e)=>(0,g.dispatch)(b.h).createSuccessNotice(t,e);function*C(){return{type:"SET_AUTOMATIONS",automations:(yield(0,x.apiFetch)({path:"/automations"})).data}}function*O(t){const e=yield(0,x.apiFetch)({path:`/automations/${t.id}/duplicate`,method:"POST"});return E((0,j.sprintf)((0,j.__)('Automation "%s" was duplicated.',"mailpoet"),t.name)),{type:"ADD_AUTOMATION",automation:e.data}}function*U(t){const e=yield(0,x.apiFetch)({path:`/automations/${t.id}`,method:"PUT",data:{status:y.b.TRASH}}),a=(0,j.__)("1 automation moved to the Trash.","mailpoet");return E(a,{id:`automation-trashed-${t.id}`,__unstableHTML:(0,w.jsxs)("p",{children:[a," ",(0,w.jsx)(S,{automation:t,previousStatus:t.status})]})}),{type:"UPDATE_AUTOMATION",automation:e.data}}function*Z(t,e){const a=yield(0,x.apiFetch)({path:`/automations/${t.id}`,method:"PUT",data:{status:e}});var o;o=`automation-trashed-${t.id}`,(0,g.dispatch)(b.h).removeNotice(o);const n=(0,j.__)("1 automation restored from the Trash.","mailpoet");return E(n,{__unstableHTML:(0,w.jsxs)("p",{children:[n," ",(0,w.jsx)(N,{automation:t,label:(0,j.__)("Edit automation","mailpoet")})]})}),{type:"UPDATE_AUTOMATION",automation:a.data}}function*P(t){return yield(0,x.apiFetch)({path:`/automations/${t.id}`,method:"DELETE"}),E((0,j.__)("1 automation and all associated data permanently deleted.","mailpoet")),{type:"DELETE_AUTOMATION",automation:t}}var M=a(92295);function D(t){return t.automations}function L(t){return t.automations?t.automations.length:M.automationCount}var H=a(83047),I=a(16951),R=a(92893),F=a(16374),$=a(532),B=a(66510),q=a(74457),z=a(67507);function Q(t){let{automation:e}=t;const a=(t=>{const[e,a]=(0,i.useState)(!1),{trashAutomation:o}=(0,k.Z)(h);if(t.status!==y.b.TRASH)return{key:"trash",control:{title:(0,j._x)("Trash","verb","mailpoet"),icon:null,onClick:()=>a(!0)},slot:(0,w.jsx)(z.Z,{isOpen:e,title:(0,j.__)("Trash automation","mailpoet"),confirmButtonText:(0,j.__)("Yes, move to trash","mailpoet"),__experimentalHideHeader:!1,onConfirm:()=>o(t),onCancel:()=>a(!1),children:(0,j.sprintf)((0,j.__)('Are you sure you want to move the automation "%s" to the Trash?',"mailpoet"),t.name)})}})(e),o=(t=>{const{restoreAutomation:e}=(0,k.Z)(h);if(t.status===y.b.TRASH)return{key:"restore",control:{title:(0,j.__)("Restore","mailpoet"),icon:null,onClick:()=>e(t,y.b.DRAFT)}}})(e),n=(t=>{const[e,a]=(0,i.useState)(!1),{deleteAutomation:o}=(0,k.Z)(h);if(t.status===y.b.TRASH)return{key:"delete",control:{title:(0,j.__)("Delete permanently","mailpoet"),icon:null,onClick:()=>a(!0)},slot:(0,w.jsx)(z.Z,{isOpen:e,title:(0,j.__)("Permanently delete automation","mailpoet"),confirmButtonText:(0,j.__)("Yes, permanently delete","mailpoet"),__experimentalHideHeader:!1,onConfirm:()=>o(t),onCancel:()=>a(!1),children:(0,j.sprintf)((0,j.__)('Are you sure you want to permanently delete "%s" and all associated data? This cannot be undone!',"mailpoet"),t.name)})}})(e),s=[a,o,n].filter((t=>t));return(0,w.jsxs)("div",{className:"mailpoet-automation-listing-cell-actions",children:[(0,w.jsx)(N,{automation:e}),s.map((t=>{let{control:e,slot:a}=t;return(0,w.jsx)(i.Fragment,{children:a},e.title)})),(0,w.jsx)(B.Z,{className:"mailpoet-automation-listing-more-button",label:(0,j.__)("More","mailpoet"),icon:q.Z,controls:s.map((t=>{let{control:e}=t;return e})),popoverProps:{position:"bottom left"}})]})}function V(t){let{automation:e}=t;return(0,w.jsx)(N,{automation:e,label:e.name})}function Y(t){let{automation:e}=t;return(0,w.jsx)("div",{className:"mailpoet-automation-listing-cell-status",children:e.status===y.b.ACTIVE?(0,j.__)("Active","mailpoet"):(0,j.__)("Draft","mailpoet")})}var K=a(14123);function W(t){let{automation:e}=t;return(0,w.jsx)(K.g,{labelPosition:"after",items:[{key:"entered",label:(0,j._x)("Entered","automation stats","mailpoet"),value:e.stats.totals.entered},{key:"processing",label:(0,j._x)("Processing","automation stats","mailpoet"),value:e.stats.totals.in_progress},{key:"exited",label:(0,j._x)("Exited","automation stats","mailpoet"),value:e.stats.totals.exited}]})}const G=[{name:"all",title:(0,j.__)("All","mailpoet"),className:"mailpoet-tab-all"},{name:y.b.ACTIVE,title:(0,j.__)("Active","mailpoet"),className:"mailpoet-tab-active"},{name:y.b.DRAFT,title:(0,j._x)("Draft","noun","mailpoet"),className:"mailpoet-tab-draft"},{name:y.b.TRASH,title:(0,j._x)("Trash","noun","mailpoet"),className:"mailpoet-tab-trash"}],J=[{key:"name",label:(0,j.__)("Name","mailpoet"),cellClassName:"mailpoet-automation-listing-cell-name"},{key:"subscribers",label:(0,j.__)("Subscribers","mailpoet")},{key:"status",label:(0,j.__)("Status","mailpoet")},{key:"actions"}];function X(){return(0,w.jsxs)(I.Z,{className:"mailpoet-automation-listing-heading",children:[(0,w.jsx)("h1",{className:"wp-heading-inline",children:(0,j.__)("Automations","mailpoet")}),(0,w.jsx)(v.ZP,{href:T.x.urls.automationTemplates,icon:$.R,variant:"primary",className:"mailpoet-add-new-button",children:(0,j.__)("New automation","mailpoet")})]})}function tt(){const t=(0,F.k6)(),e=(0,F.TH)(),a=(0,i.useMemo)((()=>new URLSearchParams(e.search)),[e]),o=(0,c.Z)((t=>t(h).getAutomations())),{loadAutomations:n}=(0,k.Z)(h),s=a.get("status");(0,i.useEffect)((()=>{n()}),[n]),(0,i.useLayoutEffect)((()=>{var t;s&&(null===(t=document.querySelector(`.mailpoet-tab-${s}`))||void 0===t||t.focus())}),[s]);const l=(0,i.useCallback)((e=>{const o=new URLSearchParams({...Object.fromEntries(a.entries()),...e}),n=Object.keys(e);(n.includes("status")||n.includes("per_page")||"1"===o.get("paged"))&&o.delete("paged"),t.push({search:o.toString()})}),[a,t]),r=(0,i.useMemo)((()=>{const t={all:[]};return(o??[]).forEach((e=>{t[e.status]||(t[e.status]=[]),t[e.status].push(e),e.status!==y.b.TRASH&&t.all.push(e)})),t}),[o]),u=(0,i.useMemo)((()=>G.map((t=>{const e=(r[t.name]??[]).length;return{name:t.name,title:(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)("span",{children:t.title}),e>0&&(0,w.jsx)("span",{className:"count",children:e})]}),className:t.className}}))),[r]),m=(0,i.useCallback)((t=>{const e=r[t.name]??[],n=parseInt(a.get("per_page")??"25",10),i=(parseInt(a.get("paged")??"1",10)-1)*n,s=e.map((t=>function(t){return[{id:t.id,value:t.name,display:(0,w.jsx)(V,{automation:t})},{id:t.id,value:null,display:(0,w.jsx)(W,{automation:t})},{id:t.id,value:t.status,display:(0,w.jsx)(Y,{automation:t})},{id:t.id,value:null,display:(0,w.jsx)(Q,{automation:t})}]}(t))).slice(i,i+n);return(0,w.jsx)(H.TableCard,{className:"mailpoet-automation-listing",title:"",isLoading:!o,headers:J,rows:s,rowKey:(t,a)=>e[a].id,rowsPerPage:n,onQueryChange:t=>e=>{l({[t]:e})},totalRows:e.length,query:Object.fromEntries(a),showMenu:!1})}),[o,r,a,l]);return(0,w.jsx)(R.Z,{className:"mailpoet-filter-tab-panel",tabs:u,onSelect:t=>{s!==t&&l({status:t})},initialTabName:s??"all",children:m},s)}var et=a(59481),at=a(79821),ot=a(38088),nt=a(96328);function it(t){let{controls:e,title:a,onClick:o,variant:n}=t;const[s,l]=(0,i.useState)(!1),r=Object.values(e).filter((t=>t.slot)),u=s?"mailpoet-option-button-opener is-busy":"mailpoet-option-button-opener";return(0,w.jsxs)("div",{className:"mailpoet-option-button",children:[(0,w.jsx)(v.ZP,{isBusy:s,disabled:s,variant:n,className:"mailpoet-option-button-main",onClick:()=>{l(!0),o(l)},children:a}),r.length>0&&r.map((t=>{let{key:e,slot:a}=t;return(0,w.jsx)(a,{},e)})),Object.values(e).length>0&&(0,w.jsx)(B.Z,{className:u,label:(0,j.__)("More","mailpoet"),icon:nt.Z,controls:Object.values(e).map((t=>({...t.control,onClick:()=>{l(!0),t.control.onClick(l)}}))),popoverProps:{position:"bottom left"}})]})}function st(){const t=ot.Hooks.applyFilters("mailpoet.automation.hero.actions",{});return(0,w.jsx)("section",{className:"mailpoet-automation-section mailpoet-automation-white-background",children:(0,w.jsxs)("div",{className:"mailpoet-automation-section-content mailpoet-automation-section-hero",children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("span",{className:"mailpoet-automation-preheading",children:(0,j.__)("Automations","mailpoet")}),(0,w.jsx)("h1",{children:(0,j.__)("Better engagement begins with automation","mailpoet")}),(0,w.jsx)("p",{children:(0,j.__)("Send emails that inform, reward, and engage your audience through powerful segmenting, scheduling, and design tools.","mailpoet")}),(0,w.jsx)(it,{variant:"primary",onClick:()=>{window.location.href=T.x.urls.automationTemplates},title:(0,j.__)("Start with a template","mailpoet"),controls:t})]}),(0,w.jsx)("img",{src:`${T.x.cdnUrl}automation/sections/hero.png`,alt:(0,j.__)("Welcome","mailpoet")})]})})}var lt=a(29351),rt=a(24876);function ut(){const t=lt.U.slice(0,3);return(0,w.jsx)("section",{className:"mailpoet-automation-section",children:(0,w.jsxs)("div",{className:"mailpoet-automation-section-content mailpoet-section-templates",children:[(0,w.jsx)("h2",{children:(0,j.__)("Explore essentials","mailpoet")}),(0,w.jsx)("p",{children:(0,j.__)("Choose from our list of pre-made templates and make it your own.","mailpoet")}),(0,w.jsx)("ul",{className:"mailpoet-section-template-list",children:t.map((t=>(0,w.jsx)(rt.v,{template:t,heading:"h3"},t.slug)))}),(0,w.jsx)(v.ZP,{variant:"link",href:T.x.urls.automationTemplates,children:(0,j.__)("Browse all templates →","mailpoet")})]})})}function mt(){const[t,e]=(0,i.useState)("start-with-a-trigger"),a=[{slug:"start-with-a-trigger",title:(0,j.__)("Start with a trigger","mailpoet"),text:(0,j.__)("Deliver relevant messages to your customers based on who they are and how they interact with your business.","mailpoet"),image:`${T.x.cdnUrl}automation/sections/start-with-a-trigger.png`},{slug:"customize-your-automation",title:(0,j.__)("Customize your automation","mailpoet"),text:(0,j.__)("Choose steps and create a custom journey to best suit your needs.","mailpoet"),image:`${T.x.cdnUrl}automation/sections/customize-your-automation.png`},{slug:"design-your-email",title:(0,j.__)("Design your email","mailpoet"),text:(0,j.__)("Modify one of our pre-made email templates or create your own design.","mailpoet"),image:`${T.x.cdnUrl}automation/sections/design-your-email.png`},{slug:"start-engaging",title:(0,j.__)("Start engaging","mailpoet"),text:(0,j.__)("Activate the automation and start engaging with your customers as they interact with your business.","mailpoet"),image:`${T.x.cdnUrl}automation/sections/start-engaging.png`}],o=a.filter((e=>e.slug===t))[0];return(0,w.jsx)("section",{className:"mailpoet-automation-section mailpoet-automation-white-background",children:(0,w.jsxs)("div",{className:"mailpoet-automation-section-content mailpoet-section-build-your-own",children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("h2",{children:(0,j.__)("Build your own automations","mailpoet")}),(0,w.jsx)("p",{children:(0,j.__)("Create customized email sequences with our new automation editor.","mailpoet")}),(0,w.jsx)("ol",{children:a.map(((a,o)=>(0,w.jsxs)("li",{className:t===a.slug?"open":"",children:[(0,w.jsx)("div",{className:"marker",children:o<10?`0${o+1}`:o+1}),(0,w.jsxs)("div",{children:[(0,w.jsx)("button",{type:"button",onClick:()=>e(a.slug),className:"mailpoet-section-build-list-button",children:a.title}),(0,w.jsx)("p",{children:a.text})]})]},a.slug)))})]}),(0,w.jsx)("img",{src:o.image,alt:o.title})]})})}function ct(){const[t,e]=(0,i.useState)(!0),a=(0,c.Z)((t=>t(h).getAutomationCount()));(0,i.useEffect)((()=>{t&&0!==a&&(T.x.trackEvent("Automations > Listing viewed"),e(!1))}),[t,a]);const o=a>0?(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(X,{}),(0,w.jsx)(tt,{})]}):(0,w.jsx)(st,{});return(0,i.useEffect)((()=>{const t="mailpoet-automation-is-onboarding",e=document.querySelector("body");0!==a||e.classList.contains(t)||e.classList.add(t),a>0&&e.classList.contains(t)&&e.classList.remove(t)}),[a]),(0,w.jsxs)(w.Fragment,{children:[o,(0,w.jsx)(ut,{}),(0,w.jsx)(mt,{})]})}function dt(){return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(r.Q,{}),(0,w.jsx)(at.w,{}),(0,w.jsx)(ct,{})]})}function pt(){return(0,w.jsx)(u.zt,{children:(0,w.jsxs)(l.BrowserRouter,{children:[(0,w.jsx)(dt,{}),(0,w.jsx)(m.Z.Slot,{})]})})}window.addEventListener("DOMContentLoaded",(()=>{(()=>{const t=(0,_.Z)(h,{actions:o,controls:x.controls,selectors:n,reducer:f,initialState:{automations:void 0}});(0,g.register)(t)})();const t=document.getElementById("mailpoet_automation");t&&((0,d.registerTranslations)(),(0,et.y)(),(0,p.q)(),s.render((0,w.jsx)(pt,{}),t))}))},65311:function(t){t.exports=jQuery}},function(t){t.O(0,[351],(function(){return 24760,t(t.s=24760)})),t.O()}]);